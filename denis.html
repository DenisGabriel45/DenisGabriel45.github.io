<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profitul lui Denis</title>
    <link rel="stylesheet" href="style2.css">
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>
</head>
<body data-id="store1">
    <h1>Bine ai revenit Denis!</h1>
    <h2><span id="date"></span> - <span id="month"></span></h2>
    <table id="profitTable"></table>
    <h3>Calculeaza-ti profitul pe luna aceasta</h3>

    <table id="weeklySummaryTable"></table>

    <script>
    // Firebase configuration (replace with your own config)
    const firebaseConfig = {
        apiKey: "AIzaSyA6O2lqCMG8Q8ap_ieenJAbtlVViWRcn2g",
        authDomain: "fptcalculator.firebaseapp.com",
        databaseURL: "https://fptcalculator-default-rtdb.firebaseio.com",
        projectId: "fptcalculator",
        storageBucket: "fptcalculator.firebasestorage.app",
        messagingSenderId: "1086743975775",
        appId: "1:1086743975775:web:7c81fd0feaeb6b7437c8ea",
        measurementId: "G-KTH80X3RZ6"
    };

    // Initialize Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    const pageID = document.body.getAttribute('data-id'); // "store1", "store2", etc.

    function createProfitTable() {
        const date = new Date();
        const month = date.getMonth(); // 0-indexed, so January is 0
        const year = date.getFullYear();
        const daysInMonth = new Date(year, month + 1, 0).getDate(); 

        const profitTable = document.getElementById('profitTable');
        profitTable.innerHTML = ''; // Clear previous content
        const headerRow = document.createElement('tr');
        const daysOfWeek = ['Luni', 'Marti', 'Miercuri', 'Joi', 'Vineri'];
        daysOfWeek.forEach(day => {
            const th = document.createElement('th');
            th.innerText = day;
            headerRow.appendChild(th);
        });
        profitTable.appendChild(headerRow);

        let currentRow;
        let dayCount = 1;

        for (let week = 0; week < 4; week++) {
            currentRow = document.createElement('tr');
            let weekdaysCount = 0;

            while (weekdaysCount < 5 && dayCount <= daysInMonth) {
                const currentDate = new Date(year, month, dayCount);
                const dayOfWeek = currentDate.getDay();

                if (dayOfWeek >= 1 && dayOfWeek <= 5) {
                    const td = document.createElement('td');
                    const input = document.createElement('input');
                    input.type = 'number';
                    input.className = 'input-cell';
                    input.placeholder = '0';
                    input.dataset.date = `${pageID}-${year}-${month + 1}-${dayCount}`; 

                    // Load saved profit from Firebase
                    database.ref(`profits/${input.dataset.date}`).once('value').then(snapshot => {
                        if (snapshot.exists()) {
                            const savedProfit = snapshot.val().profit;
                            input.value = savedProfit; // Set input value to saved profit
                            updateInputColor(input); // Update color based on loaded value
                        }
                    });

                    // Function to update background color based on value
                    input.oninput = function() {
                        const profitValue = input.value;
                        // Save profit to Firebase
                        database.ref(`profits/${input.dataset.date}`).set({
                            profit: profitValue
                        });
                        updateInputColor(input);
                        updateTotalProfit();
                    };

                    td.appendChild(input);
                    currentRow.appendChild(td);
                    weekdaysCount++;
                }
                dayCount++;
            }

            if (weekdaysCount > 0) {
                profitTable.appendChild(currentRow);
            }
        }

        updateTotalProfit();
    }

    function updateInputColor(input) {
        const value = Number(input.value);
        if (value > 0) {
            input.style.backgroundColor = 'lightgreen';
        } else if (value < 0) {
            input.style.backgroundColor = 'lightcoral';
        } else {
            input.style.backgroundColor = 'lightyellow';
        }
    }

    function updateTotalProfit() {
        let totalProfit = 0;
        const weeklySummaryTable = document.getElementById('weeklySummaryTable');
        weeklySummaryTable.innerHTML = ''; 

        const summaryHeader = document.createElement('tr');
        const headers = ['Sapt #1', 'Sapt #2', 'Sapt #3', 'Sapt #4', 'Profit Lunar'];
        headers.forEach(header => {
            const th = document.createElement('th');
            th.innerText = header;
            summaryHeader.appendChild(th);
        });
        weeklySummaryTable.appendChild(summaryHeader);

        let weeklySums = [];
        const rows = document.querySelectorAll('#profitTable tr');

        for (let i = 1; i < rows.length; i++) { // Skip the header row
            let weeklySum = 0;
            const inputs = rows[i].querySelectorAll('.input-cell');
            inputs.forEach(input => {
                const value = parseFloat(input.value) || 0;
                weeklySum += value;
            });

            totalProfit += weeklySum;
            weeklySums.push(weeklySum.toFixed(2));
        }

        const summaryRow = document.createElement('tr');
        weeklySums.forEach(sum => {
            const td = document.createElement('td');
            td.innerText = sum;
            summaryRow.appendChild(td);
        });

        const totalTd = document.createElement('td');
        totalTd.innerText = totalProfit.toFixed(2);
        summaryRow.appendChild(totalTd);

        weeklySummaryTable.appendChild(summaryRow);
    }

    function formatDate() {
        const date = new Date();
        const day = String(date.getDate()).padStart(2, '0');
        const month = String(date.getMonth() + 1).padStart(2, '0'); 
        const year = date.getFullYear();
        return `${day}/${month}/${year}`;
    }

    function getCurrentMonth() {
        const date = new Date();
        const options = { month: 'long' }; 
        return new Intl.DateTimeFormat('ro-RO', options).format(date);
    }

    window.onload = function() {
        document.getElementById('date').innerText = formatDate();
        document.getElementById('month').innerText = getCurrentMonth();
        createProfitTable();
    };
    </script>
</body>
</html>
